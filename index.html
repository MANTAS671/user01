<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackjack с курицей</title>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    color: #fff;
    background: linear-gradient(-45deg, #2b2b2b, #3c3c3c, #222, #444);
    background-size: 400% 400%;
    animation: gradientMove 10s ease infinite;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }
  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  h1 {
    margin-top: 20px;
    font-size: 2rem;
    text-shadow: 0 0 8px #ffcc00;
  }
  #balance {
    margin: 5px 0;
    font-size: 1.2rem;
  }
  /* Арена */
  .arena {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 20px auto;
    padding: 15px;
    background: rgba(0,0,0,0.5);
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(255,255,255,0.2);
  }
  /* Курица-крупье */
  .dealer img {
    width: 100px;
    transition: transform 0.5s;
  }
  .dealer.win img { transform: scale(1.2) rotate(-5deg); }
  .dealer.lose img { transform: scale(0.9) rotate(5deg); opacity: 0.8; }
  /* Карты */
  .cards {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .card {
    width: 50px;
    height: 70px;
    background: #fff;
    color: #000;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.5);
    opacity: 0;
    transform: translateY(-30px);
    animation: dealCard 0.4s forwards;
  }
  @keyframes dealCard {
    to { opacity: 1; transform: translateY(0); }
  }
  /* Кнопки */
  #controls, .bet-controls {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  button {
    background: #ffcc00;
    color: #000;
    font-weight: bold;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s;
  }
  button:hover { background: #ffe166; }
  input[type=number] {
    width: 100px;
    padding: 5px;
    font-size: 1rem;
    text-align: center;
  }
  #message {
    margin-top: 15px;
    font-size: 1.3rem;
    text-shadow: 0 0 5px #ffcc00;
    min-height: 1.5em;
  }
  /* История */
  .history {
    width: 100%;
    max-width: 600px;
    margin-top: 20px;
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    padding: 10px;
    font-size: 0.9rem;
  }
  .history table {
    width: 100%;
    border-collapse: collapse;
  }
  .history th, .history td {
    border-bottom: 1px solid #555;
    padding: 5px;
    text-align: center;
  }
  .win-row { color: #00ff90; }
  .lose-row { color: #ff4b4b; }
  .draw-row { color: #ffcc00; }
  @media(max-width:600px){
    .card { width: 40px; height: 60px; font-size: 1rem; }
    .dealer img { width: 80px; }
  }
</style>
</head>
<body>
  <h1>Blackjack с курицей</h1>
  <div id="balance"></div>
  <div class="bet-controls">
    <label>Ставка: </label>
    <input type="number" id="bet" min="100" step="100">
    <button onclick="startGame()">Начать игру</button>
  </div>

  <div class="arena">
    <div id="dealer" class="dealer" style="text-align:center;">
      <img src="https://cdn-icons-png.flaticon.com/512/1998/1998611.png" alt="Курица-крупье">
      <div>Карты крупье:</div>
      <div class="cards" id="dealer-cards"></div>
      <div>Очки: <span id="dealer-score">0</span></div>
    </div>

    <div id="player" class="player" style="text-align:center; margin-top:20px;">
      <div>Твои карты:</div>
      <div class="cards" id="player-cards"></div>
      <div>Очки: <span id="player-score">0</span></div>
    </div>

    <div id="controls" style="display:none;">
      <button onclick="hit()">Взять карту</button>
      <button onclick="stand()">Хватит</button>
    </div>

    <div id="message"></div>
  </div>

  <div class="history">
    <table>
      <thead>
        <tr><th>Результат</th><th>Ставка</th><th>Баланс</th></tr>
      </thead>
      <tbody id="history-body"></tbody>
    </table>
  </div>

  <!-- Звуки -->
  <audio id="sound-deal" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9b2a0fd1b0.mp3?filename=chicken-cluck-2-6867.mp3"></audio>
  <audio id="sound-win" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b75ec2d5e.mp3?filename=chicken-cluck-6866.mp3"></audio>
  <audio id="sound-lose" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3cbd932a7f.mp3?filename=chicken-cry-6869.mp3"></audio>

<script>
let balance = parseInt(localStorage.getItem('balance')) || 50000;
let historyData = JSON.parse(localStorage.getItem('history')) || [];
let bet = 1000;
let deck = [];
let playerCards = [];
let dealerCards = [];
let gameOver = false;

document.getElementById('bet').value = bet;
updateBalance();
renderHistory();

function createDeck() {
  const suits = ['♠', '♥', '♦', '♣'];
  const values = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
  deck = [];
  for (let s of suits) {
    for (let v of values) {
      deck.push({value:v,suit:s});
    }
  }
}

function drawCard() {
  const idx = Math.floor(Math.random()*deck.length);
  return deck.splice(idx,1)[0];
}

function calculateScore(cards) {
  let score=0, aces=0;
  for (let c of cards){
    if(['J','Q','K'].includes(c.value)) score+=10;
    else if(c.value==='A'){ score+=11; aces++; }
    else score+=parseInt(c.value);
  }
  while(score>21 && aces>0){ score-=10; aces--; }
  return score;
}

function renderCards() {
  document.getElementById('player-cards').innerHTML = playerCards.map(c=>`<div class="card">${c.value}${c.suit}</div>`).join('');
  document.getElementById('dealer-cards').innerHTML = dealerCards.map(c=>`<div class="card">${c.value}${c.suit}</div>`).join('');
  document.getElementById('player-score').textContent = calculateScore(playerCards);
  document.getElementById('dealer-score').textContent = calculateScore(dealerCards);
}

function startGame(){
  bet = parseInt(document.getElementById('bet').value);
  if(bet>balance || bet<=0){ alert('Недостаточно средств или ставка неверна'); return; }
  createDeck();
  playerCards=[drawCard(), drawCard()];
  dealerCards=[drawCard(), drawCard()];
  gameOver=false;
  document.getElementById('message').textContent='';
  document.getElementById('controls').style.display='flex';
  document.getElementById('dealer').className='dealer';
  playSound('deal');
  renderCards();
}

function hit(){
  if(gameOver) return;
  playerCards.push(drawCard());
  playSound('deal');
  renderCards();
  if(calculateScore(playerCards)>21){
    balance-=bet;
    endGame('Перебор! Ты проиграл.', 'lose');
  }
}

function stand(){
  if(gameOver) return;
  while(calculateScore(dealerCards)<17){
    dealerCards.push(drawCard());
  }
  const ps=calculateScore(playerCards);
  const ds=calculateScore(dealerCards);
  if(ds>21 || ps>ds){
    balance+=bet;
    endGame('Ты выиграл!', 'win');
  } else if(ps<ds){
    balance-=bet;
    endGame('Курица победила!', 'lose');
  } else {
    endGame('Ничья!', 'draw');
  }
}

function endGame(message, result){
  document.getElementById('message').textContent = message;
  document.getElementById('controls').style.display='none';
  document.getElementById('dealer').classList.add(result==='win'?'lose':result==='lose'?'win':'');
  playSound(result);
  updateBalance();
  addHistory(result, bet, balance);
  gameOver=true;
}

function updateBalance(){
  document.getElementById('balance').textContent = `Баланс: ${balance.toLocaleString()} MDL`;
  localStorage.setItem('balance', balance);
}

function playSound(type){
  const sounds = {
    deal:'sound-deal',
    win:'sound-win',
    lose:'sound-lose'
  };
  const el=document.getElementById(sounds[type]);
  if(el){ el.currentTime=0; el.play(); }
}

function addHistory(result, bet, bal){
  historyData.unshift({result, bet, balance: bal});
  if(historyData.length>10) historyData.pop();
  localStorage.setItem('history', JSON.stringify(historyData));
  renderHistory();
}

function renderHistory(){
  const tbody=document.getElementById('history-body');
  tbody.innerHTML='';
  historyData.forEach(h=>{
    const tr=document.createElement('tr');
    tr.className = h.result==='win'?'win-row':h.result==='lose'?'lose-row':'draw-row';
    tr.innerHTML=`<td>${h.result==='win'?'Победа':h.result==='lose'?'Проигрыш':'Ничья'}</td>
                  <td>${h.bet.toLocaleString()} MDL</td>
                  <td>${h.balance.toLocaleString()} MDL</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
